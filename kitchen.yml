driver:
  name: vagrant
  driver_config:
    ssl_verify_mode: ":verify_none"

provisioner:
  name: ansible_playbook

verifier:
  name: inspec
  sudo: true
  load_plugins: true
  reporter:
    - cli
    - json:./nginx-vanilla-results.json
  inspec_tests:
    - path: ./
  input_files:
    - ./srg-inputs.yml

platforms:
  - name: ubuntu-20.04
    lifecycle:
      post_create:
        - remote: sudo touch /etc/apt/sources.list.d/nginx.list
        - remote: echo 'deb [arch=amd64] http://nginx.org/packages/mainline/ubuntu/ focal nginx' | sudo tee -a /etc/apt/sources.list.d/nginx.list
        - remote: echo 'deb-src http://nginx.org/packages/mainline/ubuntu/ focal nginx' |  sudo tee -a /etc/apt/sources.list.d/nginx.list
        - remote: sudo wget http://nginx.org/keys/nginx_signing.key
        - remote: sudo apt-key add nginx_signing.key
        - remote: sudo apt update
        - remote: sudo apt install nginx
        - remote: sudo systemctl start nginx

    driver:
      box: bento/ubuntu-20.04 

suites:
  - name: nginx


